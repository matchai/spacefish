language: node_js
node_js:
   - "node"

jobs:
  include:
    - stage: test
      install: skip
      sudo: required
      before_install:
       - sudo apt-add-repository -y ppa:fish-shell/release-2
       - sudo apt-get update
       - sudo apt-get -y install fish
      script:
       - curl -Lo ~/.config/fish/functions/fisher.fish --create-dirs git.io/fisherman
       - fish -c "fisher fishtape"
       - fish -c "fishtape tests/*.test.fish"

    - stage: deploy gitbook
      if: branch = master AND type = push
      node_js: "node"
      script: npm run docs:build
      deploy:
       provider: pages
       # Temporary fix for https://github.com/travis-ci/travis-ci/issues/9312
       edge:
         branch: v1.8.47
       skip-cleanup: true
       github-token: $GITHUB_TOKEN
       keep-history: true
       local-dir: _book
